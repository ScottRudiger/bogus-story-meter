<!DOCTYPE html>

<html>

<head>
  <meta charset="UTF-8">
  <!--   <meta name="google-signin-client_id" content="266363285075-j69o8kv6pq8agofle7sfvqap59ceqsfu.apps.googleusercontent.com"> -->
  <title>Bogus Stories</title>
  <link rel="stylesheet" type="text/css" href="styles/stylesheet.css">

  <!-- angular, originally using v 1.6.4 for the routes, switched to match our Angular CDN-->

  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.js"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-route.js"></script>
  <!-- jquery -->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

  <!-- bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <base href="/">
</head>

<body ng-app="app">
  <script>
    var GoogleAuth;

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        'clientId': '266363285075-j69o8kv6pq8agofle7sfvqap59ceqsfu.apps.googleusercontent.com',
        'scope': 'email',
        'fetch_basic_profile': true
      }).then(function() {
        GoogleAuth = gapi.auth2.getAuthInstance();

        GoogleAuth.isSignedIn.listen(updateSigninStatus);

        GoogleAuth.currentUser.get();
        setSigninStatus();

        $('#sign-in-or-out-button').click(function() {
          handleAuthClick();
        });
        $('#revoke-access-button').click(function() {
          revokeAccess();
        });
      });
    }

    function handleAuthClick() {
      if (GoogleAuth.isSignedIn.get()) {
        GoogleAuth.signOut();
      } else {
        GoogleAuth.signIn();
      }
    }

    // we have the option to allow users to revoke the token if we wish to:

    function revokeAccess() {
      GoogleAuth.disconnect();
    }

    function setSigninStatus(isSignedIn) {
      var user = GoogleAuth.currentUser.get();
      var isAuthorized = user.hasGrantedScopes('email');
      if (isAuthorized) {
        var email = user.w3.U3;
        var accessToken = user.Zi.access_token;
        var name = user.w3.ig;
        var imageUrl = user.w3.Paa;
        $('#sign-in-or-out-button').html('Sign out');
        $('#revoke-access-button').css('display', 'inline-block');
        $('#auth-status').html('You are currently signed in and have granted ' +
          'access to this app.');
        $.ajax({
          type: 'POST',
          url: 'http://localhost:8080/auth',
          data: {
            yo: 'what up',
            username: email,
            firstLast: name,
            image: imageUrl,
            token: accessToken
          },
        });
      } else {
        $('#sign-in-or-out-button').html('Sign in With Google to See Your Info');
        $('#revoke-access-button').css('display', 'none');
        $('#auth-status').html('You have not authorized this app or you are ' +
          'signed out.');
      }
    }

    function updateSigninStatus(isSignedIn) {
      setSigninStatus();
    }
  </script>

  <button id="sign-in-or-out-button" style="margin-left: 25px">Sign in With Google to See Your Info</button>
  <button id="revoke-access-button" style="display: none; margin-left: 25px">Revoke access</button>

  <div id="auth-status" style="display: inline; padding-left: 25px"></div>
  <hr>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>

  <div ng-view></div>
  <script src="/index.js"></script>
  <script src="/components/app.js"></script>
  <script src="/services/requests.js"></script>
  <script src="/components/navbar.js"></script>
  <script src="/components/searchForm.js"></script>
  <script src="/components/recentActivity.js"></script>
  <script src="/components/stats.js"></script>
</body>

</html>